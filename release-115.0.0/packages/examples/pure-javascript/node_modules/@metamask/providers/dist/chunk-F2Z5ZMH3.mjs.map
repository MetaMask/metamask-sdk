{"version":3,"sources":["../src/shimWeb3.ts"],"sourcesContent":["import type { MetaMaskInpageProvider } from './MetaMaskInpageProvider';\nimport type { ConsoleLike } from './utils';\n\n/**\n * If no existing window.web3 is found, this function injects a web3 \"shim\" to\n * not break dapps that rely on window.web3.currentProvider.\n *\n * @param provider - The provider to set as window.web3.currentProvider.\n * @param log - The logging API to use.\n */\nexport function shimWeb3(\n  provider: MetaMaskInpageProvider,\n  log: ConsoleLike = console,\n): void {\n  let loggedCurrentProvider = false;\n  let loggedMissingProperty = false;\n\n  if (!(window as Record<string, any>).web3) {\n    const SHIM_IDENTIFIER = '__isMetaMaskShim__';\n\n    let web3Shim = { currentProvider: provider };\n    Object.defineProperty(web3Shim, SHIM_IDENTIFIER, {\n      value: true,\n      enumerable: true,\n      configurable: false,\n      writable: false,\n    });\n\n    web3Shim = new Proxy(web3Shim, {\n      get: (target, property, ...args) => {\n        if (property === 'currentProvider' && !loggedCurrentProvider) {\n          loggedCurrentProvider = true;\n          log.warn(\n            'You are accessing the MetaMask window.web3.currentProvider shim. This property is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3',\n          );\n        } else if (\n          property !== 'currentProvider' &&\n          property !== SHIM_IDENTIFIER &&\n          !loggedMissingProperty\n        ) {\n          loggedMissingProperty = true;\n          log.error(\n            `MetaMask no longer injects web3. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3`,\n          );\n          provider\n            .request({ method: 'metamask_logWeb3ShimUsage' })\n            .catch((error) => {\n              log.debug('MetaMask: Failed to log web3 shim usage.', error);\n            });\n        }\n        return Reflect.get(target, property, ...args);\n      },\n      set: (...args) => {\n        log.warn(\n          'You are accessing the MetaMask window.web3 shim. This object is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3',\n        );\n        return Reflect.set(...args);\n      },\n    });\n\n    Object.defineProperty(window, 'web3', {\n      value: web3Shim,\n      enumerable: false,\n      configurable: true,\n      writable: true,\n    });\n  }\n}\n"],"mappings":";AAUO,SAAS,SACd,UACA,MAAmB,SACb;AACN,MAAI,wBAAwB;AAC5B,MAAI,wBAAwB;AAE5B,MAAI,CAAE,OAA+B,MAAM;AACzC,UAAM,kBAAkB;AAExB,QAAI,WAAW,EAAE,iBAAiB,SAAS;AAC3C,WAAO,eAAe,UAAU,iBAAiB;AAAA,MAC/C,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,IACZ,CAAC;AAED,eAAW,IAAI,MAAM,UAAU;AAAA,MAC7B,KAAK,CAAC,QAAQ,aAAa,SAAS;AAClC,YAAI,aAAa,qBAAqB,CAAC,uBAAuB;AAC5D,kCAAwB;AACxB,cAAI;AAAA,YACF;AAAA,UACF;AAAA,QACF,WACE,aAAa,qBACb,aAAa,mBACb,CAAC,uBACD;AACA,kCAAwB;AACxB,cAAI;AAAA,YACF;AAAA,UACF;AACA,mBACG,QAAQ,EAAE,QAAQ,4BAA4B,CAAC,EAC/C,MAAM,CAAC,UAAU;AAChB,gBAAI,MAAM,4CAA4C,KAAK;AAAA,UAC7D,CAAC;AAAA,QACL;AACA,eAAO,QAAQ,IAAI,QAAQ,UAAU,GAAG,IAAI;AAAA,MAC9C;AAAA,MACA,KAAK,IAAI,SAAS;AAChB,YAAI;AAAA,UACF;AAAA,QACF;AACA,eAAO,QAAQ,IAAI,GAAG,IAAI;AAAA,MAC5B;AAAA,IACF,CAAC;AAED,WAAO,eAAe,QAAQ,QAAQ;AAAA,MACpC,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU;AAAA,IACZ,CAAC;AAAA,EACH;AACF;","names":[]}